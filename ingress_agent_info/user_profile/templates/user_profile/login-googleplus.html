{% extends "user_profile/base.html" %}
{% load sekizai_tags %}

{% block body %}
<div id="signinButton">
    <span class="g-signin" data-scope="{{ plus_scope }}"
                           data-clientid="{{ plus_id }}"
                           data-redirecturi="postmessage"
                           data-accesstype="offline"
                           data-cookiepolicy="single_host_origin"
                           data-callback="signInCallback">
    </span>
</div>

<form id="google-plus" method="post" action="{% url 'social:complete' "google-plus" %}">{% csrf_token %}
    <input id="at" type="hidden" name="access_token" value="" />
    <input id="code" type="hidden" name="code" value="" />
</form>
{% endblock %}

{% block addblocks %}
{{ block.super }}
{% addtoblock "js-head" %}
<script type="text/javascript">
    (function() {
        var po = document.createElement('script');
        po.type = 'text/javascript'; po.async = true;
        po.src = 'https://plus.google.com/js/client:plusone.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(po, s);
    })();
</script>
{% endaddtoblock %}

{% addtoblock "js-foot" %}
<script type="text/javascript">
    var signInCallback = function (result) {
        if (result["error"]) {
            alert("An error happened:", result["error"]);
        } else {
            $("#code").attr("value", result["code"]);
            $("#at").attr("value", result["access_token"]);
            $("#google-plus").submit();
        }
    };
</script>
{% endaddtoblock %}
{% endblock %}